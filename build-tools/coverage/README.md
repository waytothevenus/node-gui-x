# Generating test coverage report

Using the configuration in this directory, Github Actions CI will generate a test coverage report for the whole project. The report possibly will be split into multiple parts due to disk-space constraints related to github CI limits. This tutorial describes how to generate an html report out of this data.

## Prerequisites
- The source code of the project
- The coverage report data generated by the CI
- lcov installed, together with genhtml.

## Steps
1. Download the reports data from CI. The data is stored in the artifacts of the CI job. You can download it manually from the CI job page.
2. Unzip all the downloaded files into a single directory. They all will have the prefix `grcov-report-`.
3. Now we need to run the following command with all the files in the directory:

```bash
lcov -a grcov-report-1 -a grcov-report-2 -a grcov-report-3 -a grcov-report-4 -a grcov-report-5 -o grcov-report.info
```

where these suffixes can be different every time. The easiest way is to run this magic bash command which will concatenate all the files in the directory, prefix them with `-a`, and pass them to lcov:

```bash
ls -1a grcov-report-* | sed 's/^/-a /' | tr '\n' ' ' | xargs lcov -o grcov-report.info
```

4. Now we need to generate the html report. Go to the source code's root dir (and note where you put that grcov-report.info file)

5. run the following command (from the source code directory, necessarily):

```
genhtml --exclude /rustc/* --exclude /rust/* --exclude */.cargo/registry/* --exclude */.cargo/git/* --exclude /cargo/registry/* --exclude "*target/*" -o grcov-report --ignore-errors unmapped --ignore-errors unused ~/Desktop/Temp/cov/grcov-report.info
```

6. Now you can open the `grcov-report/index.html` file in your browser and see the report.
